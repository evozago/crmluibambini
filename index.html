<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Lui Bambini - Análise de Tempo desde Última Compra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            background-color: #343a40;
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
        }
        .sidebar .nav-link {
            color: #ced4da;
            padding: 15px 20px;
            margin-bottom: 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: #2c3136;
            color: white;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .content {
            margin-left: 250px;
            padding: 20px;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
            padding: 15px 20px;
            font-weight: 600;
        }
        .card-body {
            padding: 20px;
        }
        .stat-card {
            border-left: 4px solid;
            padding: 15px;
            margin-bottom: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .stat-card h3 {
            margin: 0;
            font-size: 1.5rem;
        }
        .stat-card p {
            margin: 0;
            color: #6c757d;
        }
        .table th {
            font-weight: 600;
            background-color: #f8f9fa;
        }
        .badge-success {
            background-color: #28a745;
        }
        .badge-warning {
            background-color: #ffc107;
        }
        .badge-danger {
            background-color: #dc3545;
        }
        .badge-info {
            background-color: #17a2b8;
        }
        .badge-secondary {
            background-color: #6c757d;
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #0d6efd;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
        }
        .step::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #e9ecef;
            z-index: -1;
        }
        .step:last-child::after {
            display: none;
        }
        .step.active {
            color: #0d6efd;
            font-weight: bold;
        }
        .step.completed {
            color: #28a745;
        }
        .step.active::after, .step.completed::after {
            background-color: #0d6efd;
        }
        .bi-cloud-arrow-up {
            font-size: 3rem;
            color: #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <h4 class="text-center mb-4">CRM Lui Bambini</h4>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-page="dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="clientes">
                            <i class="bi bi-people"></i> Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="mensagens">
                            <i class="bi bi-chat-dots"></i> Mensagens
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="estatisticas">
                            <i class="bi bi-bar-chart"></i> Estatísticas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="importacao">
                            <i class="bi bi-upload"></i> Importação
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Content -->
            <div class="col-md-10 content">
                <!-- Dashboard Page -->
                <div id="dashboard-content" class="page-content">
                    <h2 class="mb-4">Dashboard</h2>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left-color: #28a745;">
                                <p>Clientes Ativos</p>
                                <h3>1,245</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left-color: #ffc107;">
                                <p>Em Risco</p>
                                <h3>328</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left-color: #dc3545;">
                                <p>Inativos</p>
                                <h3>157</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left-color: #17a2b8;">
                                <p>Tempo Médio</p>
                                <h3>45 dias</h3>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    Distribuição por Tempo desde Última Compra
                                </div>
                                <div class="card-body">
                                    <canvas id="distributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    Clientes que Precisam de Atenção
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Maria Silva
                                            <span class="badge bg-danger rounded-pill">120 dias</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            João Santos
                                            <span class="badge bg-danger rounded-pill">115 dias</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Ana Oliveira
                                            <span class="badge bg-warning rounded-pill">85 dias</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Carlos Pereira
                                            <span class="badge bg-warning rounded-pill">78 dias</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Fernanda Costa
                                            <span class="badge bg-warning rounded-pill">65 dias</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    Últimas Compras
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Cliente</th>
                                                    <th>Data da Última Compra</th>
                                                    <th>Valor</th>
                                                    <th>Dias Desde Última Compra</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Roberto Almeida</td>
                                                    <td>15/09/2025</td>
                                                    <td>R$ 350,00</td>
                                                    <td>15</td>
                                                    <td><span class="badge bg-success">Ativo</span></td>
                                                </tr>
                                                <tr>
                                                    <td>Patrícia Lima</td>
                                                    <td>10/09/2025</td>
                                                    <td>R$ 420,00</td>
                                                    <td>20</td>
                                                    <td><span class="badge bg-success">Ativo</span></td>
                                                </tr>
                                                <tr>
                                                    <td>Marcos Souza</td>
                                                    <td>28/08/2025</td>
                                                    <td>R$ 180,00</td>
                                                    <td>33</td>
                                                    <td><span class="badge bg-success">Ativo</span></td>
                                                </tr>
                                                <tr>
                                                    <td>Juliana Ferreira</td>
                                                    <td>15/08/2025</td>
                                                    <td>R$ 550,00</td>
                                                    <td>46</td>
                                                    <td><span class="badge bg-warning">Em Risco</span></td>
                                                </tr>
                                                <tr>
                                                    <td>Ricardo Santos</td>
                                                    <td>02/08/2025</td>
                                                    <td>R$ 290,00</td>
                                                    <td>59</td>
                                                    <td><span class="badge bg-warning">Em Risco</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clientes Page -->
                <div id="clientes-content" class="page-content" style="display: none;">
                    <h2 class="mb-4">Clientes</h2>
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Buscar cliente...">
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select">
                                        <option selected>Todos os Status</option>
                                        <option>Ativos (0-30 dias)</option>
                                        <option>Ativos (31-60 dias)</option>
                                        <option>Em Risco (61-90 dias)</option>
                                        <option>Em Risco Alto (91-180 dias)</option>
                                        <option>Inativos (181-365 dias)</option>
                                        <option>Perdidos (>365 dias)</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary w-100">Filtrar</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>CPF</th>
                                            <th>Telefone</th>
                                            <th>Última Compra</th>
                                            <th>Dias Inativo</th>
                                            <th>Status</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Maria Silva</td>
                                            <td>123.456.789-00</td>
                                            <td>(11) 98765-4321</td>
                                            <td>02/06/2025</td>
                                            <td>120</td>
                                            <td><span class="badge bg-danger">Inativo</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>João Santos</td>
                                            <td>987.654.321-00</td>
                                            <td>(11) 91234-5678</td>
                                            <td>07/06/2025</td>
                                            <td>115</td>
                                            <td><span class="badge bg-danger">Inativo</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Ana Oliveira</td>
                                            <td>456.789.123-00</td>
                                            <td>(11) 97654-3210</td>
                                            <td>07/07/2025</td>
                                            <td>85</td>
                                            <td><span class="badge bg-warning">Em Risco</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Carlos Pereira</td>
                                            <td>789.123.456-00</td>
                                            <td>(11) 93456-7890</td>
                                            <td>14/07/2025</td>
                                            <td>78</td>
                                            <td><span class="badge bg-warning">Em Risco</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Fernanda Costa</td>
                                            <td>321.654.987-00</td>
                                            <td>(11) 95678-1234</td>
                                            <td>27/07/2025</td>
                                            <td>65</td>
                                            <td><span class="badge bg-warning">Em Risco</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Roberto Almeida</td>
                                            <td>654.987.321-00</td>
                                            <td>(11) 92345-6789</td>
                                            <td>15/09/2025</td>
                                            <td>15</td>
                                            <td><span class="badge bg-success">Ativo</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Patrícia Lima</td>
                                            <td>234.567.891-00</td>
                                            <td>(11) 94567-8901</td>
                                            <td>10/09/2025</td>
                                            <td>20</td>
                                            <td><span class="badge bg-success">Ativo</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Marcos Souza</td>
                                            <td>567.891.234-00</td>
                                            <td>(11) 96789-0123</td>
                                            <td>28/08/2025</td>
                                            <td>33</td>
                                            <td><span class="badge bg-success">Ativo</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Juliana Ferreira</td>
                                            <td>891.234.567-00</td>
                                            <td>(11) 98901-2345</td>
                                            <td>15/08/2025</td>
                                            <td>46</td>
                                            <td><span class="badge bg-warning">Em Risco</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Ricardo Santos</td>
                                            <td>345.678.912-00</td>
                                            <td>(11) 90123-4567</td>
                                            <td>02/08/2025</td>
                                            <td>59</td>
                                            <td><span class="badge bg-warning">Em Risco</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                                <button class="btn btn-sm btn-outline-success">Mensagem</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <nav>
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Anterior</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Próximo</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Mensagens Page -->
                <div id="mensagens-content" class="page-content" style="display: none;">
                    <h2 class="mb-4">Mensagens Personalizadas</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    Categorias de Clientes
                                </div>
                                <div class="card-body">
                                    <div class="list-group">
                                        <a href="#" class="list-group-item list-group-item-action active" data-category="ativos-recentes">
                                            Ativos Recentes (0-30 dias)
                                            <span class="badge bg-primary float-end">245</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" data-category="ativos">
                                            Ativos (31-60 dias)
                                            <span class="badge bg-primary float-end">183</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" data-category="risco">
                                            Em Risco (61-90 dias)
                                            <span class="badge bg-primary float-end">128</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" data-category="risco-alto">
                                            Em Risco Alto (91-180 dias)
                                            <span class="badge bg-primary float-end">97</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" data-category="inativos">
                                            Inativos (181-365 dias)
                                            <span class="badge bg-primary float-end">76</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" data-category="perdidos">
                                            Perdidos (>365 dias)
                                            <span class="badge bg-primary float-end">81</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    Modelo de Mensagem - Ativos Recentes (0-30 dias)
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="messageTemplate" class="form-label">Template da Mensagem</label>
                                        <textarea class="form-control" id="messageTemplate" rows="8">Olá {nome},

Obrigado por sua compra recente em nossa loja! Esperamos que esteja satisfeito com seus produtos.

Queremos informar que temos novidades que podem ser do seu interesse. Que tal passar em nossa loja para conferir?

Atenciosamente,
Equipe Lui Bambini</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Variáveis Disponíveis</label>
                                        <div class="d-flex flex-wrap gap-2">
                                            <span class="badge bg-secondary">{nome}</span>
                                            <span class="badge bg-secondary">{dias_inativo}</span>
                                            <span class="badge bg-secondary">{ultima_compra}</span>
                                            <span class="badge bg-secondary">{valor_ultima_compra}</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="previewClient" class="form-label">Visualizar para Cliente</label>
                                        <select class="form-select" id="previewClient">
                                            <option>Roberto Almeida</option>
                                            <option>Patrícia Lima</option>
                                            <option>Marcos Souza</option>
                                        </select>
                                    </div>
                                    <div class="card mb-3">
                                        <div class="card-header">
                                            Prévia da Mensagem
                                        </div>
                                        <div class="card-body">
                                            <p>Olá Roberto Almeida,</p>
                                            <p>Obrigado por sua compra recente em nossa loja! Esperamos que esteja satisfeito com seus produtos.</p>
                                            <p>Queremos informar que temos novidades que podem ser do seu interesse. Que tal passar em nossa loja para conferir?</p>
                                            <p>Atenciosamente,<br>Equipe Lui Bambini</p>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-primary">Salvar Template</button>
                                        <button class="btn btn-success">Copiar Mensagem</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas Page -->
                <div id="estatisticas-content" class="page-content" style="display: none;">
                    <h2 class="mb-4">Estatísticas</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Distribuição de Clientes por Tempo de Inatividade
                                </div>
                                <div class="card-body">
                                    <canvas id="clientDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Tendência de Inatividade (Últimos 6 Meses)
                                </div>
                                <div class="card-body">
                                    <canvas id="inactivityTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    Resumo por Categoria
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Categoria</th>
                                                    <th>Quantidade</th>
                                                    <th>Porcentagem</th>
                                                    <th>Valor Médio da Última Compra</th>
                                                    <th>Ação Recomendada</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Ativos Recentes (0-30 dias)</td>
                                                    <td>245</td>
                                                    <td>30.2%</td>
                                                    <td>R$ 320,00</td>
                                                    <td>Oferecer produtos complementares</td>
                                                </tr>
                                                <tr>
                                                    <td>Ativos (31-60 dias)</td>
                                                    <td>183</td>
                                                    <td>22.6%</td>
                                                    <td>R$ 285,00</td>
                                                    <td>Enviar novidades e promoções</td>
                                                </tr>
                                                <tr>
                                                    <td>Em Risco (61-90 dias)</td>
                                                    <td>128</td>
                                                    <td>15.8%</td>
                                                    <td>R$ 250,00</td>
                                                    <td>Oferecer desconto para retorno</td>
                                                </tr>
                                                <tr>
                                                    <td>Em Risco Alto (91-180 dias)</td>
                                                    <td>97</td>
                                                    <td>12.0%</td>
                                                    <td>R$ 230,00</td>
                                                    <td>Contato telefônico e desconto especial</td>
                                                </tr>
                                                <tr>
                                                    <td>Inativos (181-365 dias)</td>
                                                    <td>76</td>
                                                    <td>9.4%</td>
                                                    <td>R$ 210,00</td>
                                                    <td>Campanha de reativação</td>
                                                </tr>
                                                <tr>
                                                    <td>Perdidos (>365 dias)</td>
                                                    <td>81</td>
                                                    <td>10.0%</td>
                                                    <td>R$ 190,00</td>
                                                    <td>Pesquisa de satisfação e oferta exclusiva</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Importação Page -->
                <div id="importacao-content" class="page-content" style="display: none;">
                    <h2 class="mb-4">Importação de Planilhas</h2>
                    <div class="card">
                        <div class="card-body">
                            <div class="step-indicator">
                                <div class="step active" id="step-upload">
                                    <div>Upload</div>
                                    <small>Envie suas planilhas</small>
                                </div>
                                <div class="step" id="step-mapping">
                                    <div>Mapeamento</div>
                                    <small>Configure as colunas</small>
                                </div>
                                <div class="step" id="step-processing">
                                    <div>Processamento</div>
                                    <small>Integração dos dados</small>
                                </div>
                                <div class="step" id="step-conclusion">
                                    <div>Conclusão</div>
                                    <small>Dados importados</small>
                                </div>
                            </div>

                            <!-- Step 1: Upload -->
                            <div id="step1-content">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100">
                                            <div class="card-header">
                                                Planilha de Vendas
                                            </div>
                                            <div class="card-body">
                                                <div class="upload-area" id="upload-vendas">
                                                    <i class="bi bi-cloud-arrow-up"></i>
                                                    <h4>Arraste e solte a planilha de vendas aqui</h4>
                                                    <p>ou clique para selecionar o arquivo</p>
                                                    <input type="file" id="file-vendas" class="d-none" accept=".xlsx,.xls">
                                                </div>
                                                <div id="vendas-file-info" class="mt-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100">
                                            <div class="card-header">
                                                Planilha de Clientes
                                            </div>
                                            <div class="card-body">
                                                <div class="upload-area" id="upload-clientes">
                                                    <i class="bi bi-cloud-arrow-up"></i>
                                                    <h4>Arraste e solte a planilha de clientes aqui</h4>
                                                    <p>ou clique para selecionar o arquivo</p>
                                                    <input type="file" id="file-clientes" class="d-none" accept=".xlsx,.xls">
                                                </div>
                                                <div id="clientes-file-info" class="mt-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end mt-3">
                                    <button class="btn btn-primary" id="btn-next-step1" disabled>Próximo</button>
                                </div>
                            </div>

                            <!-- Step 2: Mapping -->
                            <div id="step2-content" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-header">
                                                Mapeamento de Colunas - Vendas
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Campo Necessário</th>
                                                                <th>Coluna na Planilha</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="vendas-mapping">
                                                            <tr>
                                                                <td>Data</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-data">
                                                                        <option value="data" selected>data</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Movimentação</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-movimentacao">
                                                                        <option value="movimentacao" selected>movimentacao</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Quantidade</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-quantidade">
                                                                        <option value="quantidade" selected>quantidade</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Total</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-total">
                                                                        <option value="total" selected>total</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Cliente</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-cliente">
                                                                        <option value="cliente" selected>cliente</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Vendedor</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-vendedor">
                                                                        <option value="vendedor" selected>vendedor</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Telefone</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-telefone">
                                                                        <option value="telefone" selected>telefone</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Custo de Venda</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-custo">
                                                                        <option value="custo" selected>custo</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Lucro de Venda</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-vendas-lucro">
                                                                        <option value="lucro" selected>lucro</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-header">
                                                Mapeamento de Colunas - Clientes
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Campo Necessário</th>
                                                                <th>Coluna na Planilha</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="clientes-mapping">
                                                            <tr>
                                                                <td>ID</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-id">
                                                                        <option value="third_id" selected>third_id</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Nome</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-nome">
                                                                        <option value="nome" selected>nome</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>CPF</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-cpf">
                                                                        <option value="cpf" selected>cpf</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Telefone 1</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-telefone1">
                                                                        <option value="telefone_1" selected>telefone_1</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Telefone 2</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-telefone2">
                                                                        <option value="telefone_2" selected>telefone_2</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Telefone 3</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-telefone3">
                                                                        <option value="telefone_3" selected>telefone_3</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Data de Cadastro</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-data">
                                                                        <option value="data_cadastro" selected>data_cadastro</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>Crédito Loja</td>
                                                                <td>
                                                                    <select class="form-select form-select-sm" id="map-clientes-credito">
                                                                        <option value="credito_loja" selected>credito_loja</option>
                                                                    </select>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-3">
                                    <button class="btn btn-secondary" id="btn-prev-step2">Anterior</button>
                                    <button class="btn btn-primary" id="btn-next-step2">Próximo</button>
                                </div>
                            </div>

                            <!-- Step 3: Processing -->
                            <div id="step3-content" style="display: none;">
                                <div class="card">
                                    <div class="card-header">
                                        Processamento de Dados
                                    </div>
                                    <div class="card-body">
                                        <div class="text-center mb-4">
                                            <div class="spinner-border text-primary" role="status" id="processing-spinner">
                                                <span class="visually-hidden">Processando...</span>
                                            </div>
                                            <h4 class="mt-3" id="processing-status">Processando dados...</h4>
                                            <div class="progress mt-3">
                                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" id="processing-progress" style="width: 0%"></div>
                                            </div>
                                        </div>
                                        <div id="processing-log" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;">
                                            <div class="text-muted">Aguardando início do processamento...</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-3">
                                    <button class="btn btn-secondary" id="btn-prev-step3" disabled>Anterior</button>
                                    <button class="btn btn-primary" id="btn-next-step3" disabled>Próximo</button>
                                </div>
                            </div>

                            <!-- Step 4: Conclusion -->
                            <div id="step4-content" style="display: none;">
                                <div class="card">
                                    <div class="card-header">
                                        Importação Concluída
                                    </div>
                                    <div class="card-body text-center">
                                        <div class="mb-4">
                                            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                                        </div>
                                        <h3 class="mb-3">Dados importados com sucesso!</h3>
                                        <div class="row justify-content-center">
                                            <div class="col-md-8">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered">
                                                        <tbody>
                                                            <tr>
                                                                <th>Clientes Processados:</th>
                                                                <td id="conclusion-clientes">0</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Vendas Processadas:</th>
                                                                <td id="conclusion-vendas">0</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Registros de Última Compra:</th>
                                                                <td id="conclusion-ultima-compra">0</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Tempo de Processamento:</th>
                                                                <td id="conclusion-tempo">0 segundos</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-3">
                                    <button class="btn btn-secondary" id="btn-prev-step4">Anterior</button>
                                    <button class="btn btn-success" id="btn-finish">Concluir</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize charts
            initCharts();

            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const pageContents = document.querySelectorAll('.page-content');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-page');

                    // Update active link
                    navLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');

                    // Show target page
                    pageContents.forEach(page => {
                        page.style.display = 'none';
                    });
                    document.getElementById(`${targetPage}-content`).style.display = 'block';
                });
            });

            // File Upload Handling
            setupFileUpload('vendas');
            setupFileUpload('clientes');

            // Step Navigation
            document.getElementById('btn-next-step1').addEventListener('click', function() {
                goToStep(2);
            });

            document.getElementById('btn-prev-step2').addEventListener('click', function() {
                goToStep(1);
            });

            document.getElementById('btn-next-step2').addEventListener('click', function() {
                goToStep(3);
                startProcessing();
            });

            document.getElementById('btn-prev-step3').addEventListener('click', function() {
                goToStep(2);
            });

            document.getElementById('btn-next-step3').addEventListener('click', function() {
                goToStep(4);
            });

            document.getElementById('btn-prev-step4').addEventListener('click', function() {
                goToStep(3);
            });

            document.getElementById('btn-finish').addEventListener('click', function() {
                // Reset the import process and go back to step 1
                resetImport();
                goToStep(1);
                // Navigate to dashboard
                document.querySelector('.nav-link[data-page="dashboard"]').click();
            });
        });

        // Initialize Charts
        function initCharts() {
            // Dashboard Distribution Chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            const distributionChart = new Chart(distributionCtx, {
                type: 'bar',
                data: {
                    labels: ['0-30 dias', '31-60 dias', '61-90 dias', '91-180 dias', '181-365 dias', '>365 dias'],
                    datasets: [{
                        label: 'Número de Clientes',
                        data: [245, 183, 128, 97, 76, 81],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(40, 167, 69, 0.5)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(255, 193, 7, 0.5)',
                            'rgba(220, 53, 69, 0.7)',
                            'rgba(220, 53, 69, 0.5)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Statistics Client Distribution Chart
            const clientDistributionCtx = document.getElementById('clientDistributionChart').getContext('2d');
            const clientDistributionChart = new Chart(clientDistributionCtx, {
                type: 'pie',
                data: {
                    labels: ['Ativos Recentes', 'Ativos', 'Em Risco', 'Em Risco Alto', 'Inativos', 'Perdidos'],
                    datasets: [{
                        data: [30.2, 22.6, 15.8, 12.0, 9.4, 10.0],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(40, 167, 69, 0.5)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(255, 193, 7, 0.5)',
                            'rgba(220, 53, 69, 0.7)',
                            'rgba(220, 53, 69, 0.5)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    }
                }
            });

            // Statistics Inactivity Trend Chart
            const inactivityTrendCtx = document.getElementById('inactivityTrendChart').getContext('2d');
            const inactivityTrendChart = new Chart(inactivityTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro'],
                    datasets: [
                        {
                            label: 'Ativos',
                            data: [410, 425, 440, 430, 445, 428],
                            borderColor: 'rgba(40, 167, 69, 1)',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Em Risco',
                            data: [210, 205, 215, 225, 230, 225],
                            borderColor: 'rgba(255, 193, 7, 1)',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Inativos',
                            data: [150, 155, 160, 155, 150, 157],
                            borderColor: 'rgba(220, 53, 69, 1)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // File Upload Handling
        function setupFileUpload(type) {
            const uploadArea = document.getElementById(`upload-${type}`);
            const fileInput = document.getElementById(`file-${type}`);
            const fileInfo = document.getElementById(`${type}-file-info`);

            // Click on upload area
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('border-primary');
            });

            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('border-primary');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-primary');
                
                if (e.dataTransfer.files.length) {
                    handleFile(e.dataTransfer.files[0], type);
                }
            });

            // File input change
            fileInput.addEventListener('change', function() {
                if (this.files.length) {
                    handleFile(this.files[0], type);
                }
            });
        }

        // Global variables to store file data
        let vendasFile = null;
        let clientesFile = null;
        let vendasData = null;
        let clientesData = null;

        // Handle file selection
        function handleFile(file, type) {
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                alert('Por favor, selecione um arquivo Excel (.xlsx ou .xls)');
                return;
            }

            const fileInfo = document.getElementById(`${type}-file-info`);
            fileInfo.innerHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-file-earmark-excel"></i> ${file.name} (${formatFileSize(file.size)})
                </div>
            `;

            // Store the file
            if (type === 'vendas') {
                vendasFile = file;
            } else {
                clientesFile = file;
            }

            // Read the file using SheetJS
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // Store the data
                    if (type === 'vendas') {
                        vendasData = jsonData;
                        populateColumnMapping('vendas', jsonData[0]);
                    } else {
                        clientesData = jsonData;
                        populateColumnMapping('clientes', jsonData[0]);
                    }

                    // Enable next button if both files are uploaded
                    checkFilesUploaded();
                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    fileInfo.innerHTML = `
                        <div class="alert alert-danger">
                            Erro ao ler o arquivo: ${error.message}
                        </div>
                    `;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Populate column mapping dropdowns
        function populateColumnMapping(type, headers) {
            const mappingContainer = document.getElementById(`${type}-mapping`);
            const rows = mappingContainer.querySelectorAll('tr');
            
            rows.forEach(row => {
                const select = row.querySelector('select');
                const currentValue = select.value;
                
                // Clear options
                select.innerHTML = '';
                
                // Add options for each header
                headers.forEach(header => {
                    const option = document.createElement('option');
                    option.value = header;
                    option.textContent = header;
                    select.appendChild(option);
                });
                
                // Try to select the original value
                if (headers.includes(currentValue)) {
                    select.value = currentValue;
                }
            });
        }

        // Check if both files are uploaded
        function checkFilesUploaded() {
            const nextButton = document.getElementById('btn-next-step1');
            if (vendasFile && clientesFile) {
                nextButton.disabled = false;
            } else {
                nextButton.disabled = true;
            }
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // Navigation between steps
        function goToStep(step) {
            // Hide all step contents
            document.getElementById('step1-content').style.display = 'none';
            document.getElementById('step2-content').style.display = 'none';
            document.getElementById('step3-content').style.display = 'none';
            document.getElementById('step4-content').style.display = 'none';
            
            // Show the target step content
            document.getElementById(`step${step}-content`).style.display = 'block';
            
            // Update step indicators
            const steps = document.querySelectorAll('.step');
            steps.forEach((s, i) => {
                s.classList.remove('active', 'completed');
                if (i + 1 < step) {
                    s.classList.add('completed');
                } else if (i + 1 === step) {
                    s.classList.add('active');
                }
            });
        }

        // Process the data
        function startProcessing() {
            const processingLog = document.getElementById('processing-log');
            const progressBar = document.getElementById('processing-progress');
            const processingStatus = document.getElementById('processing-status');
            const nextButton = document.getElementById('btn-next-step3');
            const prevButton = document.getElementById('btn-prev-step3');
            
            // Reset log and progress
            processingLog.innerHTML = '';
            progressBar.style.width = '0%';
            prevButton.disabled = true;
            nextButton.disabled = true;
            
            // Start time
            const startTime = new Date();
            
            // Log function
            function log(message) {
                const now = new Date();
                const timestamp = now.toLocaleTimeString();
                processingLog.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                processingLog.scrollTop = processingLog.scrollHeight;
            }
            
            // Simulate processing steps
            log('Iniciando processamento dos dados...');
            
            setTimeout(() => {
                log('Lendo planilha de vendas...');
                progressBar.style.width = '10%';
                
                setTimeout(() => {
                    log(`Processados ${vendasData.length - 1} registros de vendas.`);
                    progressBar.style.width = '20%';
                    
                    setTimeout(() => {
                        log('Lendo planilha de clientes...');
                        progressBar.style.width = '30%';
                        
                        setTimeout(() => {
                            log(`Processados ${clientesData.length - 1} registros de clientes.`);
                            progressBar.style.width = '40%';
                            
                            setTimeout(() => {
                                log('Integrando dados de vendas e clientes...');
                                progressBar.style.width = '60%';
                                
                                setTimeout(() => {
                                    log('Calculando tempo desde última compra...');
                                    progressBar.style.width = '80%';
                                    
                                    setTimeout(() => {
                                        log('Salvando dados no banco de dados...');
                                        progressBar.style.width = '90%';
                                        
                                        setTimeout(() => {
                                            const endTime = new Date();
                                            const processingTime = (endTime - startTime) / 1000;
                                            
                                            log(`Processamento concluído em ${processingTime.toFixed(1)} segundos.`);
                                            progressBar.style.width = '100%';
                                            processingStatus.textContent = 'Processamento concluído!';
                                            processingStatus.classList.add('text-success');
                                            document.getElementById('processing-spinner').style.display = 'none';
                                            
                                            // Update conclusion data
                                            document.getElementById('conclusion-clientes').textContent = clientesData.length - 1;
                                            document.getElementById('conclusion-vendas').textContent = vendasData.length - 1;
                                            document.getElementById('conclusion-ultima-compra').textContent = Math.floor((clientesData.length - 1) * 0.8);
                                            document.getElementById('conclusion-tempo').textContent = `${processingTime.toFixed(1)} segundos`;
                                            
                                            // Enable next button
                                            nextButton.disabled = false;
                                            prevButton.disabled = false;
                                        }, 1000);
                                    }, 1000);
                                }, 1000);
                            }, 1000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 1000);
        }

        // Reset import process
        function resetImport() {
            // Reset files
            vendasFile = null;
            clientesFile = null;
            vendasData = null;
            clientesData = null;
            
            // Reset file info
            document.getElementById('vendas-file-info').innerHTML = '';
            document.getElementById('clientes-file-info').innerHTML = '';
            
            // Reset file inputs
            document.getElementById('file-vendas').value = '';
            document.getElementById('file-clientes').value = '';
            
            // Reset buttons
            document.getElementById('btn-next-step1').disabled = true;
            
            // Reset processing elements
            document.getElementById('processing-progress').style.width = '0%';
            document.getElementById('processing-spinner').style.display = 'inline-block';
            document.getElementById('processing-status').textContent = 'Processando dados...';
            document.getElementById('processing-status').classList.remove('text-success');
            document.getElementById('processing-log').innerHTML = '<div class="text-muted">Aguardando início do processamento...</div>';
        }
    </script>
</body>
</html>
